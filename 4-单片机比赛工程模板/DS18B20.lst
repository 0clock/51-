C51 COMPILER V9.60.7.0   DS18B20                                                           04/21/2023 17:04:01 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE DS18B20
OBJECT MODULE PLACED IN .\OBJ\DS18B20.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE Library\src\DS18B20.c LARGE OMF2 WARNINGLEVEL(1) OPTIMIZE(8,SPEED) BROWS
                    -E INCDIR(.\Library\inc;.\USER) PRINT(.\DS18B20.lst) TABS(2) OBJECT(.\OBJ\DS18B20.obj)

line level    source

   1          /*********************************************************************************************************
   2          ** 工程功能 ：温度计DS18B20 头文件
   3          ** 工程作者 ：Blue Sky Teams――WCW
   4          ** 工程版本 ：V1.0
   5          *********************************************************************************************************/
   6          
   7          #include"DS18B20.h"
   8          
   9          uint TPH =0;                           //存放温度值的高字节
  10          uint TPL =0;                           //存放温度值的低字节
  11          float TP=0;             //存放温度值的十进制数
  12          
  13          
  14          /*********************************************************************************************************
  15          ** 函数功能 ：DS18B20复位函数
  16          ** 函数说明 ：复位DS18B20,并检测设备是否存在
  17          ** 入口参数 ：无
  18          ** 出口参数 ：无
  19          *********************************************************************************************************/
  20          void DS18B20_Reset()
  21          {
  22   1          uchar flag;
  23   1      
  24   1          DQ = 0;                     //送出低电平复位信号
  25   1          Delay_Us(250);              //延时至少480us
  26   1          Delay_Us(250);
  27   1          DQ = 1;                     //释放数据线
  28   1          Delay_Us(15);               //等待60us
  29   1        while(flag)
  30   1            flag = DQ;              //检测存在脉冲
  31   1      
  32   1          Delay_Us(250);              //等待设备释放数据线
  33   1          Delay_Us(250);
  34   1        Delay_Us(250);
  35   1      }
  36          
  37          /*********************************************************************************************************
  38          ** 函数功能 ：DS18B20读字节函数
  39          ** 函数说明 ：从DS18B20读1字节数据
  40          ** 入口参数 ：无
  41          ** 出口参数 ：从DS18B20读回的1字节数据
  42          *********************************************************************************************************/
  43          uchar DS18B20_ReadByte()
  44          {
  45   1          uchar i;
  46   1          uchar dat = 0;
  47   1      
  48   1          for (i=0; i<8; i++)             //8位计数器
  49   1          {
  50   2              DQ = 0;                     //开始时间片
  51   2              Delay_Us(1);                //延时等待
  52   2              DQ = 1;                     //准备接收
  53   2              Delay_Us(6);                //接收延时
  54   2      
C51 COMPILER V9.60.7.0   DS18B20                                                           04/21/2023 17:04:01 PAGE 2   

  55   2              if (DQ) dat |= 0x80;        //读取数据
  56   2          dat >>=1;
  57   2              Delay_Us(50);               //等待时间片结束
  58   2          }
  59   1      
  60   1          return dat;
  61   1      }
  62          
  63          /*********************************************************************************************************
  64          ** 函数功能 ：DS18B20写字节函数
  65          ** 函数说明 ：向DS18B20写1字节数据
  66          ** 入口参数 ：要写入DS18B20的1字节数据
  67          ** 出口参数 ：无
  68          *********************************************************************************************************/
  69          void DS18B20_WriteByte(uchar dat)
  70          {
  71   1          char i;
  72   1      
  73   1          for (i=0; i<8; i++)             //8位计数器
  74   1          {
  75   2              DQ = 0;                     //开始时间片
  76   2              Delay_Us(1);                //延时等待
  77   2              DQ= dat & 0x01;       //送出数据
  78   2              Delay_Us(60);               //等待时间片结束
  79   2              DQ = 1;                     //恢复数据线
  80   2              Delay_Us(1);                //恢复延时
  81   2          dat >>= 1;
  82   2          }
  83   1      }
  84          
  85          /*********************************************************************************************************
  86          ** 函数功能 ：DS18B20开始转化温度数据
  87          ** 函数说明 ：到转化结束需要一定时间，否则读取的还是旧数据
  88          ** 入口参数 ：
  89          ** 出口参数 ：
  90          *********************************************************************************************************/
  91          void DS18B20_Start()
  92          {
  93   1        DS18B20_Reset();                //设备复位
  94   1        DS18B20_WriteByte(0xCC);        //跳过ROM命令
  95   1        DS18B20_WriteByte(0x44);      //开始转换命令
  96   1      }
  97          
  98          
  99          /*********************************************************************************************************
 100          ** 函数功能 ：读取并计算 DS18B20 的温度
 101          ** 函数说明 ：到转化结束需要一定时间，否则读取的还是旧数据
 102          ** 入口参数 ：
 103          ** 出口参数 ：
 104          *********************************************************************************************************/
 105          void DS18B20_End()
 106          {
 107   1        DS18B20_Reset();                //设备复位  
 108   1        DS18B20_WriteByte(0xCC);        //跳过ROM命令   
 109   1        DS18B20_WriteByte(0xBE);        //读暂存存储器命令
 110   1        TPL = DS18B20_ReadByte();       //读温度低字节
 111   1        TPH = DS18B20_ReadByte();       //读温度高字节
 112   1        
 113   1        TP=((TPH<<8)|TPL)*0.0625;     //将读取的数据转换成十进制数
 114   1      }
 115          
 116          
C51 COMPILER V9.60.7.0   DS18B20                                                           04/21/2023 17:04:01 PAGE 3   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    241    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      8       5
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
